define(["game","log","eventemiter","storage"],function(d,g,e,f){return App=e.extend({init:function(){this._super();var a=this;this.game=new d;this.storage=new f;this.game.setStorage(this.storage);var b;this.game.on("score:update",function(d,c){a.score.className="splah";a.score.innerHTML="Score: <i>"+c+"</i>";clearTimeout(b);b=setTimeout(function(){a.score.className=""},1E3)});this.game.on("fps:update",function(b,c){a.fps.innerHTML=c+"fps"});this.score=document.getElementById("score");this.mute=document.getElementById("mute");
this.fps=document.getElementById("fps");this.fullscreen=document.getElementById("fullscreen");if(!this.storage.getAudioState())this.mute.className="fa fa-volume-off",this.game.audio.toggle();this.mute.addEventListener("click",function(){a.mute.className=a.game.audio.enabled?"fa fa-volume-off":"fa fa-volume-up";a.game.audio.toggle();a.storage.setAudioState(a.game.audio.isEnabled())},!1);this.fullscreen.addEventListener("click",function(){document.fullscreenEnabled?exitFullscreen():document.documentElement.requestFullscreen?
document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen()},!1);document.getElementById("startBtn").addEventListener("click",function(){if(!a.game.running)a.game.restart(),document.getElementById("legend").className="hidden"},!1);
window.addEventListener("resize",function(){a.resize(window.innerWidth,window.innerHeight)},!1);setInterval(_.bind(this.update,this),1E3)},update:function(){},resize:function(a,b){600>a||400>b||this.game.resize(a,b)}})});